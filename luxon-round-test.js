import { DateTime } from './luxon-round.js';
import { describe, it } from "node:test";
import assert from "node:assert";

function createTests(op, testData) {
  testData.forEach(d => {
    const [input, unit, multiple, expected] = d;
    createTest(op, input, unit, multiple, expected)
  })
}

function createTest(op, input, unit, multiple, expected) {
  it(`${op} ${unit} to multiple of ${multiple} of ${input} to ${expected}`,
    () => assert.strictEqual(DateTime.fromISO(input)[op](unit, multiple).toISO(), expected));      
}

describe('DateTime.floor', () => {
  createTests('floor', [
    ["2025-10-03T11:45:11.014+02:00", 'minute', 15, "2025-10-03T11:45:00.000+02:00"],
    ["2025-10-03T12:59:12.014+02:00", 'minute', 15, "2025-10-03T12:45:00.000+02:00"],
    ["2025-10-03T13:00:00.000+02:00", 'minute', 15, "2025-10-03T13:00:00.000+02:00"],
    ["2025-10-03T14:00:01.014+02:00", 'minute',  5, "2025-10-03T14:00:00.000+02:00"],
    ["2025-10-03T15:45:11.014+02:00", 'day', 10, "2025-09-30T00:00:00.000+02:00"],
    ["2025-08-03T16:59:12.014+02:00", 'month', 3, "2025-06-01T00:00:00.000+02:00"],
    ["2025-10-03T17:00:00.000+02:00", 'year', 100, "2000-01-01T00:00:00.000+01:00"],
  ]);
});

describe('DateTime.round', () => {
  createTests('round', [
    ["2025-10-03T11:45:11.014+02:00", 'minute', 15, "2025-10-03T11:45:00.000+02:00"],
    ["2025-10-03T12:59:12.014+02:00", 'minute', 15, "2025-10-03T13:00:00.000+02:00"],
    ["2025-10-03T13:00:00.000+02:00", 'minute', 15, "2025-10-03T13:00:00.000+02:00"],
    ["2025-10-03T14:00:01.014+02:00", 'minute',  5, "2025-10-03T14:00:00.000+02:00"],
    ["2025-10-03T15:45:11.014+02:00", 'day', 10, "2025-09-30T00:00:00.000+02:00"],
    ["2025-09-03T16:59:12.014+02:00", 'month', 1, "2025-09-01T00:00:00.000+02:00"],
    ["2025-10-03T17:00:00.000+02:00", 'year', 100, "2000-01-01T00:00:00.000+01:00"],
  ]);
});

describe('DateTime.ceil', () => {
  createTests('ceil', [
    ["2025-10-03T11:45:11.014+02:00", 'minute', 15, "2025-10-03T12:00:00.000+02:00"],
    ["2025-10-03T12:59:12.014+02:00", 'minute', 15, "2025-10-03T13:00:00.000+02:00"],
    ["2025-10-03T13:00:00.000+02:00", 'minute', 15, "2025-10-03T13:00:00.000+02:00"],
    ["2025-10-03T14:00:01.014+02:00", 'minute',  5, "2025-10-03T14:05:00.000+02:00"],
    ["2025-10-03T15:45:11.014+02:00", 'day', 10, "2025-10-10T00:00:00.000+02:00"],
    ["2025-09-03T16:59:12.014+02:00", 'month', 1, "2025-10-01T00:00:00.000+02:00"],
    ["2025-10-03T17:00:00.000+02:00", 'year', 100, "2100-01-01T00:00:00.000+01:00"],
  ]);
});
